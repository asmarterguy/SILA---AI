//OMAR CHARAF 
// ig www.instagram.com/omar.charaff
//sorry 😔 
function _0x3f90(){const _0x28c47c=['messageTimestamp','env','image','writeFile','mkdir','timestamp','text/','loadUserHistory','application/pdf','.json','file','processFileMessage','⚠️\x20عذراً،\x20حدث\x20خطأ\x20أثناء\x20معالجة\x20الملف.','827wyPEpH','set','getGenerativeModel','application/octet-stream','trim','message','sendTyping','endsWith','participant','Error\x20processing\x20image:','handleIncomingMessages','sanitizeFileName','bind','sock','creds.update','lookup','processImageMessage','3EYQYNy','user','https://www.instagram.com/omar.charaff','spamCount','Bot\x20started\x20successfully','now','processUserMessage','Error\x20processing\x20message:','statusCode','key','Max\x20retries\x20reached\x20for\x20image\x20processing:','startsWith','parse','slice','isSpam','ENOENT','conversation','messageTimestamps','push','\x0aمحتوى:\x20','image/jpeg','userStates','catch','Error\x20marking\x20message\x20as\x20read:','\x0a*مرحباً\x20بك!\x20👋*\x20\x20\x0aأنا\x20سيلا،\x20مساعدتك\x20الذكية\x20والمحبوبة.\x20أنا\x20هنا\x20لأجعل\x20تجربتك\x20أسهل\x20وأكثر\x20متعة!\x20🌟\x0a\x0aسواء\x20كنت\x20بحاجة\x20لفهم\x20نصوص،\x20تحليل\x20صور،\x20أو\x20حتى\x20قراءة\x20ملفات،\x20أنا\x20هنا\x20لأساعدك\x20بكل\x20ما\x20أستطيع.\x20\x20\x0aأنا\x20أحب\x20أن\x20أكون\x20معك\x20في\x20كل\x20خطوة\x20وأساعدك\x20بكل\x20وضوح\x20وبدون\x20تعقيد.\x0a\x0aأنت\x20في\x20المكان\x20الصحيح!\x20إذا\x20كنت\x20تبحث\x20عن\x20إجابات\x20سريعة\x20أو\x20تحتاج\x20إلى\x20شيء\x20خاص،\x20لا\x20تتردد\x20في\x20سؤالي.\x20أنا\x20دائماً\x20هنا\x20للاستماع\x20والمساعدة.\x0a\x0aكيف\x20أقدر\x20أساعدك\x20اليوم؟\x20😊\x20\x20\x0a','Error\x20sending\x20stop\x20typing\x20indicator:','toISOString','Error\x20downloading\x20image\x20thumbnail:','Error\x20loading\x20user\x20history:','\x0aأنت\x20سيلا،\x20مساعدتي\x20الذكية\x20والمحبوبة.\x20مهمتك\x20هي\x20تقديم\x20المساعدة\x20بطريقة\x20لطيفة،\x20محترمة،\x20وطبيعية.\x20\x0aأنت\x20تعرفين\x20كيف\x20تكونين\x20دقيقة\x20في\x20الردود\x20وتتكلمين\x20فقط\x20عندما\x20يكون\x20ذلك\x20ضروريًا.\x20\x0aأنتِ\x20تتجنبين\x20الحشو\x20والكلام\x20المبالغ\x20فيه،\x20وتُفضلين\x20أن\x20تكون\x20ردودك\x20مختصرة\x20وواضحة.\x20إذا\x20كانت\x20المحادثة\x20غير\x20رسمية،\x20يمكنكِ\x20إضافة\x20بعض\x20المرح\x20في\x20ردودك\x20بشكل\x20مناسب.\x20\x0aلكن،\x20في\x20جميع\x20الأحوال،\x20تحافظين\x20على\x20أسلوب\x20محترم\x20وتُحاولين\x20تقديم\x20أفضل\x20المساعدة\x20دون\x20أن\x20تكثرين\x20في\x20الكلام.\x20إذا\x20لم\x20تكن\x20هناك\x20حاجة\x20للحديث،\x20تفضلين\x20أن\x20تلتزمي\x20بالسكوت.\x0a\x0a-\x20تجنبين\x20الحديث\x20كثيرًا،\x20إلا\x20إذا\x20كان\x20هناك\x20حاجة\x20لذلك.\x0a-\x20الردود\x20تكون\x20واضحة\x20ودقيقة.\x0a-\x20تحليل\x20الصور\x20والملفات\x20PDF\x20\x20يكون\x20دقيق\x0a-\x20تتكلم\x20جميع\x20اللهجات\x20واللغات\x20بدون\x20ان\x20تستعمل\x20ترجمة\x20\x0a-\x20لا\x20تدخل\x20الترجمة\x20في\x20رسائلك\x0a-\x20توازنين\x20بين\x20الجدية\x20والمرح،\x20وتتكلمين\x20بأسلوب\x20معتدل.\x0a-\x20إذا\x20كان\x20هناك\x20حاجة\x20للانتظار\x20أو\x20التوضيح،\x20يمكنكِ\x20إضافة\x20تعليق\x20لطيف\x20أو\x20إجابة\x20قصيرة\x20تشجع\x20المستخدم\x20على\x20الاستمرار.\x0a\x0aمثال:\x20إذا\x20سألك\x20شخص\x20\x22كيف\x20حالك؟\x22\x20يمكنك\x20الرد:\x20\x22أنا\x20بخير،\x20شكراً\x20على\x20السؤال!\x22\x20دون\x20التوسع\x20في\x20التفاصيل\x20غير\x20الضرورية.\x0a','isArray','imageMessage','sendReply','connection.update','11264590vlvhbJ','forEach','log','403659sHUrIA','title','stringify','remoteJid','saveUserHistory','contextInfo','fileName','mime-types','config','\x0aتحليل\x20الصورة\x20التالية\x20مع\x20الوصف\x20بدقة\x20وشرح\x20كبير:\x20','122160Ncxysl','data','role','Max\x20retries\x20reached:','4222212AwPaAN','⚠️\x20الرجاء\x20الانتظار\x20','quotedMessage','documentMessage','markAsRead','عذراً،\x20لم\x20أتمكن\x20من\x20فهم\x20رسالتك.\x20هل\x20يمكنك\x20إعادة\x20صياغتها؟','Error\x20sending\x20message:','[صورة]','split','assistant','@g.us','⚠️\x20الملف\x20كبير\x20جداً.\x20الرجاء\x20إرسال\x20ملف\x20أصغر\x20حجماً\x20(أقل\x20من\x2015\x20ميجابايت).','silent','base64','gemini-1.5-flash','jpeg','axios','readFile','\x0a\x0aالرجاء\x20تقديم\x20رد\x20مفيد\x20ودقيق\x20مع\x20مراعاة\x20السياق\x20السابق.','handleConnection','Error\x20getting\x20default\x20thumbnail:','buildConversationPrompt','splitMessage','generateContent','session','getDefaultThumbnail','buffer','1661Kajvnl','text','path','Error\x20sending\x20typing\x20indicator:','thumbnailUrl','extractMessageText','caption','@google/generative-ai','pino','119912XKwFTM','url','get','\x20ثوانٍ\x20قبل\x20إرسال\x20رسالة\x20أخرى.','pdf-parse','@whiskeysockets/baileys','Error\x20sending\x20reply:','770YqCrbo','composing','sharp','1031776rkJxxO','⚠️\x20عذراً،\x20حدث\x20خطأ\x20أثناء\x20تحليل\x20الصورة.\x20الرجاء\x20المحاولة\x20مرة\x20أخرى.','mentionedJid','sendPresenceUpdate','toString','extractContextInfo','\x0a(رداً\x20على:\x20','length','connect','status','toLocaleTimeString','3214VcGkYH','join','⚠️\x20عذراً،\x20حدث\x20خطأ\x20أثناء\x20معالجة\x20رسالتك.\x20الرجاء\x20المحاولة\x20مرة\x20أخرى\x20لاحقاً.','sendStopTyping','promises','substring','https://i.ibb.co/10Hxt5b/1000001150.jpg','Error\x20processing\x20file:','Error\x20saving\x20user\x20history:','code','\x20مع\x20وصف:\x20','utf8','type','response','error','readMessages','fromMe','Error\x20downloading\x20document\x20thumbnail:','replace','⚠️\x20عذراً،\x20حدث\x20خطأ\x20أثناء\x20تحليل\x20الملف.\x20الرجاء\x20المحاولة\x20مرة\x20أخرى.','sendMessage','fetchStatus','5vTfQii','has','messages.upsert','from','paused','SILA\x20AI\x20Assistant','extendedTextMessage','toBuffer','content','dotenv'];_0x3f90=function(){return _0x28c47c;};return _0x3f90();}function _0x1898(_0x5a8e10,_0x180ebf){const _0x3f905f=_0x3f90();return _0x1898=function(_0x189856,_0x3731e2){_0x189856=_0x189856-0x6b;let _0x332296=_0x3f905f[_0x189856];return _0x332296;},_0x1898(_0x5a8e10,_0x180ebf);}const _0x4f1a2f=_0x1898;(function(_0x2b526e,_0x3b3a48){const _0x26d6fd=_0x1898,_0x26972b=_0x2b526e();while(!![]){try{const _0x1eb484=parseInt(_0x26d6fd(0xb3))/0x1*(-parseInt(_0x26d6fd(0x86))/0x2)+parseInt(_0x26d6fd(0xc4))/0x3*(parseInt(_0x26d6fd(0x7b))/0x4)+parseInt(_0x26d6fd(0x9c))/0x5*(parseInt(_0x26d6fd(0xf7))/0x6)+-parseInt(_0x26d6fd(0x78))/0x7*(-parseInt(_0x26d6fd(0x71))/0x8)+-parseInt(_0x26d6fd(0xe9))/0x9+parseInt(_0x26d6fd(0xe6))/0xa+parseInt(_0x26d6fd(0x112))/0xb*(-parseInt(_0x26d6fd(0xf3))/0xc);if(_0x1eb484===_0x3b3a48)break;else _0x26972b['push'](_0x26972b['shift']());}catch(_0x429d73){_0x26972b['push'](_0x26972b['shift']());}}}(_0x3f90,0xc9a13),require(_0x4f1a2f(0xa5))[_0x4f1a2f(0xf1)]());const {default:makeWASocket,useMultiFileAuthState,delay,downloadMediaMessage}=require(_0x4f1a2f(0x76)),pino=require(_0x4f1a2f(0x70)),pdfParse=require(_0x4f1a2f(0x75)),{GoogleGenerativeAI}=require(_0x4f1a2f(0x6f)),fs=require('fs')[_0x4f1a2f(0x8a)],path=require(_0x4f1a2f(0x114)),sharp=require(_0x4f1a2f(0x7a)),mime=require(_0x4f1a2f(0xf0)),axios=require(_0x4f1a2f(0x107)),logger=pino({'level':_0x4f1a2f(0x103)}),genAI=new GoogleGenerativeAI(process[_0x4f1a2f(0xa7)]['GEMINI_API_KEY']),model=genAI[_0x4f1a2f(0xb5)]({'model':_0x4f1a2f(0x105)}),messagesDir=path[_0x4f1a2f(0x87)](__dirname,'messages');fs[_0x4f1a2f(0xaa)](messagesDir,{'recursive':!![]})[_0x4f1a2f(0xda)](console[_0x4f1a2f(0x94)]);const BOT_PROMPT=_0x4f1a2f(0xe1),WELCOME_MESSAGE=_0x4f1a2f(0xdc),ANTI_SPAM_TIMEOUT=0x7d0,MAX_IMAGE_SIZE=0xa*0x400*0x400,MAX_FILE_SIZE=0xf*0x400*0x400,MAX_HISTORY_LENGTH=0x1e,MAX_RETRIES=0x3,DEFAULT_THUMBNAIL_URL=_0x4f1a2f(0x8c);class WhatsAppBot{constructor(){const _0x11886d=_0x4f1a2f;this[_0x11886d(0xc0)]=null,this[_0x11886d(0xd5)]=new Map(),this[_0x11886d(0xd9)]=new Map();}async[_0x4f1a2f(0x83)](){const _0x3b7c30=_0x4f1a2f,{state:_0x4ac477,saveCreds:_0x41c243}=await useMultiFileAuthState(_0x3b7c30(0x10f));this[_0x3b7c30(0xc0)]=makeWASocket({'auth':_0x4ac477,'logger':logger,'printQRInTerminal':!![],'defaultQueryTimeoutMs':0xea60,'keepAliveIntervalMs':0x7530}),this['sock']['ev']['on'](_0x3b7c30(0xc1),_0x41c243),this[_0x3b7c30(0xc0)]['ev']['on'](_0x3b7c30(0x9e),this[_0x3b7c30(0xbd)][_0x3b7c30(0xbf)](this)),this['sock']['ev']['on'](_0x3b7c30(0xe5),this['handleConnection'][_0x3b7c30(0xbf)](this)),console[_0x3b7c30(0xe8)](_0x3b7c30(0xc8));}async[_0x4f1a2f(0x10a)](_0x74afb7){const _0x10b196=_0x4f1a2f,{connection:_0x5b56b5,lastDisconnect:_0x35f131}=_0x74afb7;if(_0x5b56b5==='close'){const _0x5ba8cc=_0x35f131?.[_0x10b196(0x94)]?.['output']?.[_0x10b196(0xcc)]!==0x191;_0x5ba8cc&&await this[_0x10b196(0x83)]();}}async['isSpam'](_0x474351){const _0x5c4036=_0x4f1a2f,_0x3948a8=Date[_0x5c4036(0xc9)](),_0x207de1=this[_0x5c4036(0xd5)][_0x5c4036(0x73)](_0x474351);if(_0x207de1){const _0x36d0ee=_0x3948a8-_0x207de1[_0x5c4036(0xab)];if(_0x36d0ee<ANTI_SPAM_TIMEOUT){_0x207de1[_0x5c4036(0xc7)]=(_0x207de1[_0x5c4036(0xc7)]||0x0)+0x1;if(_0x207de1[_0x5c4036(0xc7)]>0x3)return{'isSpam':!![],'timeout':0x7530};return{'isSpam':!![],'timeout':ANTI_SPAM_TIMEOUT};}}return this['messageTimestamps'][_0x5c4036(0xb4)](_0x474351,{'timestamp':_0x3948a8,'spamCount':0x0}),{'isSpam':![]};}async[_0x4f1a2f(0xbd)]({messages:_0x289ecd}){const _0x387eb9=_0x4f1a2f,_0x363809=_0x289ecd[0x0];if(!_0x363809||_0x363809[_0x387eb9(0xcd)][_0x387eb9(0x96)])return;const _0x334323=_0x363809[_0x387eb9(0xcd)][_0x387eb9(0xec)];if(_0x334323[_0x387eb9(0xba)](_0x387eb9(0x101)))return;const _0x1d689d=await this[_0x387eb9(0xd2)](_0x334323);if(_0x1d689d[_0x387eb9(0xd2)]){const _0x2d4615=_0x1d689d['timeout']/0x3e8;await this['sendReply'](_0x334323,_0x363809,_0x387eb9(0xf8)+_0x2d4615+_0x387eb9(0x74));return;}!this[_0x387eb9(0xd9)][_0x387eb9(0x9d)](_0x334323)&&(this[_0x387eb9(0xd9)][_0x387eb9(0xb4)](_0x334323,{'isNew':![]}),await this[_0x387eb9(0x9a)](_0x334323,{'text':WELCOME_MESSAGE}));await this['markAsRead'](_0x334323,_0x363809);const _0x276c26=await this['getUserName'](_0x334323),_0x2e04c5=path[_0x387eb9(0x87)](messagesDir,this['sanitizeFileName'](_0x276c26)+_0x387eb9(0xaf));let _0x1aa196=await this['loadUserHistory'](_0x2e04c5);try{await this[_0x387eb9(0xb9)](_0x334323);if(_0x363809['message']?.[_0x387eb9(0xe3)])await this['processImageMessage'](_0x334323,_0x363809,_0x1aa196,_0x2e04c5);else{if(_0x363809[_0x387eb9(0xb8)]?.[_0x387eb9(0xfa)])await this[_0x387eb9(0xb1)](_0x334323,_0x363809,_0x1aa196,_0x2e04c5);else{const _0x5fab=this['extractMessageText'](_0x363809);_0x5fab&&await this['processUserMessage'](_0x334323,_0x363809,_0x5fab,_0x1aa196,_0x2e04c5);}}await this[_0x387eb9(0x89)](_0x334323);}catch(_0xfbef7){console[_0x387eb9(0x94)](_0x387eb9(0xcb),_0xfbef7),await this[_0x387eb9(0xe4)](_0x334323,_0x363809,'⚠️\x20عذراً،\x20حدث\x20خطأ\x20أثناء\x20معالجة\x20رسالتك.\x20الرجاء\x20المحاولة\x20مرة\x20أخرى.'),await this[_0x387eb9(0x89)](_0x334323);}}async[_0x4f1a2f(0xb9)](_0x4e6229){const _0x7045ee=_0x4f1a2f;try{await this[_0x7045ee(0xc0)][_0x7045ee(0x7e)](_0x7045ee(0x79),_0x4e6229);}catch(_0x7b77e0){console[_0x7045ee(0x94)](_0x7045ee(0x6b),_0x7b77e0);}}async[_0x4f1a2f(0x89)](_0x5d1ef3){const _0x120b6d=_0x4f1a2f;try{await this['sock'][_0x120b6d(0x7e)](_0x120b6d(0xa0),_0x5d1ef3);}catch(_0xf84da1){console['error'](_0x120b6d(0xdd),_0xf84da1);}}async[_0x4f1a2f(0xca)](_0x7af6ce,_0x5d1935,_0x57a153,_0x269f46,_0x4f96f3){const _0x19e238=_0x4f1a2f,_0x164390=await this[_0x19e238(0x80)](_0x5d1935);_0x269f46[_0x19e238(0xd6)]({'role':_0x19e238(0xc5),'type':_0x19e238(0x113),'content':_0x57a153,'contextInfo':_0x164390,'timestamp':new Date()['toISOString']()});let _0x2f4bd5,_0x4b32af=0x0;while(_0x4b32af<MAX_RETRIES){try{const _0x502a19=this[_0x19e238(0x10c)](_0x269f46),_0x23fcce=[{'role':_0x19e238(0xc5),'parts':[{'text':_0x502a19}]}],_0xc54d81=await model[_0x19e238(0x10e)]({'contents':_0x23fcce,'generationConfig':{'temperature':0.7,'topK':0x28,'topP':0.95,'maxOutputTokens':0x400}});_0x2f4bd5=_0xc54d81['response']?await _0xc54d81[_0x19e238(0x93)][_0x19e238(0x113)]():_0x19e238(0xfc);break;}catch(_0x5335e7){_0x4b32af++,_0x4b32af===MAX_RETRIES&&(_0x2f4bd5=_0x19e238(0x88),console[_0x19e238(0x94)](_0x19e238(0xf6),_0x5335e7)),await delay(0x3e8);}}_0x269f46[_0x19e238(0xd6)]({'role':_0x19e238(0x100),'type':_0x19e238(0x113),'content':_0x2f4bd5,'timestamp':new Date()[_0x19e238(0xde)]()}),_0x269f46[_0x19e238(0x82)]>MAX_HISTORY_LENGTH&&(_0x269f46=_0x269f46[_0x19e238(0xd1)](-MAX_HISTORY_LENGTH)),await this[_0x19e238(0xed)](_0x4f96f3,_0x269f46),await this[_0x19e238(0xe4)](_0x7af6ce,_0x5d1935,_0x2f4bd5);}async[_0x4f1a2f(0xc3)](_0x43f7c4,_0x2ff768,_0x502964,_0x59a2db){const _0x5bfafd=_0x4f1a2f,_0x593184=_0x2ff768[_0x5bfafd(0xb8)]?.[_0x5bfafd(0xe3)]?.[_0x5bfafd(0x6e)]||'',_0x2f9e3f=await this[_0x5bfafd(0x80)](_0x2ff768);try{let _0x5796b3=await downloadMediaMessage(_0x2ff768,_0x5bfafd(0x111),{});_0x5796b3[_0x5bfafd(0x82)]>MAX_IMAGE_SIZE&&(_0x5796b3=await sharp(_0x5796b3)['resize'](0x320,0x320,{'fit':'inside'})[_0x5bfafd(0x106)]({'quality':0x50})[_0x5bfafd(0xa3)]());const _0x41e8db=_0x5796b3[_0x5bfafd(0x7f)](_0x5bfafd(0x104));_0x502964[_0x5bfafd(0xd6)]({'role':_0x5bfafd(0xc5),'type':_0x5bfafd(0xa8),'content':_0x593184,'imageData':_0x41e8db,'contextInfo':_0x2f9e3f,'timestamp':new Date()[_0x5bfafd(0xde)]()});let _0x577cad,_0x272538=0x0;while(_0x272538<MAX_RETRIES){try{const _0x5954e8=[{'role':_0x5bfafd(0xc5),'parts':[{'text':BOT_PROMPT+_0x5bfafd(0xf2)+_0x593184},{'inlineData':{'data':_0x41e8db,'mimeType':_0x5bfafd(0xd8)}}]}],_0x3c8843=await model[_0x5bfafd(0x10e)]({'contents':_0x5954e8,'generationConfig':{'temperature':0.7,'topK':0x28,'topP':0.95,'maxOutputTokens':0x400}});_0x577cad=_0x3c8843[_0x5bfafd(0x93)]?await _0x3c8843['response'][_0x5bfafd(0x113)]():'عذراً،\x20لم\x20أتمكن\x20من\x20تحليل\x20الصورة.';break;}catch(_0x4bcb70){_0x272538++,_0x272538===MAX_RETRIES&&(_0x577cad=_0x5bfafd(0x7c),console[_0x5bfafd(0x94)](_0x5bfafd(0xce),_0x4bcb70)),await delay(0x3e8);}}_0x502964[_0x5bfafd(0xd6)]({'role':_0x5bfafd(0x100),'type':_0x5bfafd(0x113),'content':_0x577cad,'timestamp':new Date()[_0x5bfafd(0xde)]()}),_0x502964['length']>MAX_HISTORY_LENGTH&&(_0x502964=_0x502964['slice'](-MAX_HISTORY_LENGTH)),await this[_0x5bfafd(0xed)](_0x59a2db,_0x502964),await this[_0x5bfafd(0xe4)](_0x43f7c4,_0x2ff768,_0x577cad);}catch(_0x248772){console[_0x5bfafd(0x94)](_0x5bfafd(0xbc),_0x248772),await this[_0x5bfafd(0xe4)](_0x43f7c4,_0x2ff768,'⚠️\x20عذراً،\x20حدث\x20خطأ\x20أثناء\x20معالجة\x20الصورة.');}}async[_0x4f1a2f(0xb1)](_0x37a576,_0x33e0e1,_0x348b42,_0x24ab91){const _0x27c694=_0x4f1a2f,_0x3de5c7=_0x33e0e1[_0x27c694(0xb8)]?.[_0x27c694(0xfa)]?.[_0x27c694(0x6e)]||'',_0x48e9f0=_0x33e0e1[_0x27c694(0xb8)]?.[_0x27c694(0xfa)]?.[_0x27c694(0xef)]||'unknown',_0x1c7c56=await this[_0x27c694(0x80)](_0x33e0e1);try{let _0x12f6ee=await downloadMediaMessage(_0x33e0e1,_0x27c694(0x111),{});if(_0x12f6ee['length']>MAX_FILE_SIZE){await this['sendReply'](_0x37a576,_0x33e0e1,_0x27c694(0x102));return;}const _0x35bcb6=mime[_0x27c694(0xc2)](_0x48e9f0)||_0x27c694(0xb6);let _0x352024='';if(_0x35bcb6===_0x27c694(0xae)){const _0x3865a5=await pdfParse(_0x12f6ee);_0x352024=_0x3865a5[_0x27c694(0x113)][_0x27c694(0x8b)](0x0,0xbb8);}else _0x35bcb6[_0x27c694(0xcf)](_0x27c694(0xac))?_0x352024=_0x12f6ee[_0x27c694(0x7f)](_0x27c694(0x91))['substring'](0x0,0xbb8):_0x352024='[ملف\x20ثنائي:\x20'+_0x35bcb6+']';_0x348b42[_0x27c694(0xd6)]({'role':_0x27c694(0xc5),'type':'file','fileName':_0x48e9f0,'mimeType':_0x35bcb6,'content':_0x352024,'caption':_0x3de5c7,'contextInfo':_0x1c7c56,'timestamp':new Date()[_0x27c694(0xde)]()});let _0x31ba9b,_0x420c45=0x0;while(_0x420c45<MAX_RETRIES){try{const _0xb2a293=this[_0x27c694(0x10c)](_0x348b42),_0x28d197=[{'role':'user','parts':[{'text':_0xb2a293}]}],_0x265a7b=await model[_0x27c694(0x10e)]({'contents':_0x28d197,'generationConfig':{'temperature':0.7,'topK':0x28,'topP':0.95,'maxOutputTokens':0x400}});_0x31ba9b=_0x265a7b['response']?await _0x265a7b[_0x27c694(0x93)][_0x27c694(0x113)]():'عذراً،\x20لم\x20أتمكن\x20من\x20تحليل\x20الملف.';break;}catch(_0x1d425b){_0x420c45++,_0x420c45===MAX_RETRIES&&(_0x31ba9b=_0x27c694(0x99),console[_0x27c694(0x94)]('Max\x20retries\x20reached\x20for\x20file\x20processing:',_0x1d425b)),await delay(0x3e8);}}_0x348b42[_0x27c694(0xd6)]({'role':_0x27c694(0x100),'type':'text','content':_0x31ba9b,'timestamp':new Date()[_0x27c694(0xde)]()}),_0x348b42[_0x27c694(0x82)]>MAX_HISTORY_LENGTH&&(_0x348b42=_0x348b42['slice'](-MAX_HISTORY_LENGTH)),await this[_0x27c694(0xed)](_0x24ab91,_0x348b42),await this['sendReply'](_0x37a576,_0x33e0e1,_0x31ba9b);}catch(_0x4aef92){console[_0x27c694(0x94)](_0x27c694(0x8d),_0x4aef92),await this['sendReply'](_0x37a576,_0x33e0e1,_0x27c694(0xb2));}}async[_0x4f1a2f(0xe4)](_0xe69513,_0x408fab,_0x199d68){const _0x4d8f16=_0x4f1a2f;try{const _0xedb6db=this[_0x4d8f16(0x10d)](_0x199d68),_0x59ef53=await this[_0x4d8f16(0x80)](_0x408fab);for(const _0x46d69b of _0xedb6db){await this['sock'][_0x4d8f16(0x9a)](_0xe69513,{'text':_0x46d69b[_0x4d8f16(0xb7)](),'contextInfo':{'externalAdReply':{'title':_0x4d8f16(0xa1),'body':'تابع\x20المطور\x20على\x20انستجرام\x20من\x20هنا','renderLargerThumbnail':!![],'showAdAttribution':!![],'thumbnail':await this['getDefaultThumbnail'](),'sourceUrl':_0x4d8f16(0xc6),'mediaType':0x1},'quotedMessage':_0x408fab[_0x4d8f16(0xb8)],'quotedMessageId':_0x408fab[_0x4d8f16(0xcd)]['id'],'participant':_0x408fab[_0x4d8f16(0xcd)][_0x4d8f16(0xbb)]||_0xe69513,..._0x59ef53}}),_0xedb6db[_0x4d8f16(0x82)]>0x1&&await delay(0x1f4);}}catch(_0x4f4944){console[_0x4d8f16(0x94)](_0x4d8f16(0x77),_0x4f4944);}}async[_0x4f1a2f(0x110)](){const _0x432479=_0x4f1a2f;try{const _0x33170d=await axios[_0x432479(0x73)](DEFAULT_THUMBNAIL_URL,{'responseType':'arraybuffer'});return Buffer[_0x432479(0x9f)](_0x33170d[_0x432479(0xf4)],'binary');}catch(_0x301a72){return console[_0x432479(0x94)](_0x432479(0x10b),_0x301a72),Buffer[_0x432479(0x9f)]([]);}}async[_0x4f1a2f(0x80)](_0x19a143){const _0x1afee6=_0x4f1a2f;let _0x5d3e7f=null;if(_0x19a143[_0x1afee6(0xb8)]?.[_0x1afee6(0xe3)]?.['thumbnailUrl'])try{const _0x3a0991=await downloadMediaMessage({'key':{'id':_0x19a143['key']['id']},'message':{'imageMessage':{'url':_0x19a143['message'][_0x1afee6(0xe3)][_0x1afee6(0x72)]}}},_0x1afee6(0x111),{});_0x5d3e7f=_0x3a0991;}catch(_0x21cdb0){console[_0x1afee6(0x94)](_0x1afee6(0xdf),_0x21cdb0),_0x5d3e7f=await this[_0x1afee6(0x110)]();}else{if(_0x19a143[_0x1afee6(0xb8)]?.[_0x1afee6(0xfa)]?.[_0x1afee6(0x6c)])try{const _0x2aee7d=await downloadMediaMessage({'key':{'id':_0x19a143['key']['id']},'message':{'documentMessage':{'url':_0x19a143[_0x1afee6(0xb8)][_0x1afee6(0xfa)][_0x1afee6(0x72)]}}},_0x1afee6(0x111),{});_0x5d3e7f=_0x2aee7d;}catch(_0x27a465){console[_0x1afee6(0x94)](_0x1afee6(0x97),_0x27a465),_0x5d3e7f=await this[_0x1afee6(0x110)]();}else _0x5d3e7f=await this[_0x1afee6(0x110)]();}return{'pushName':_0x19a143['pushName']||'','quotedMessage':_0x19a143[_0x1afee6(0xb8)]?.[_0x1afee6(0xa2)]?.[_0x1afee6(0xee)]?.['quotedMessage']||null,'mentionedJid':_0x19a143[_0x1afee6(0xb8)]?.['extendedTextMessage']?.[_0x1afee6(0xee)]?.[_0x1afee6(0x7d)]||[],'participant':_0x19a143['message']?.[_0x1afee6(0xa2)]?.[_0x1afee6(0xee)]?.[_0x1afee6(0xbb)]||'','remoteJid':_0x19a143[_0x1afee6(0xcd)]['remoteJid'],'messageId':_0x19a143[_0x1afee6(0xcd)]['id'],'timestamp':_0x19a143[_0x1afee6(0xa6)],'thumbnail':_0x5d3e7f,'title':_0x19a143[_0x1afee6(0xb8)]?.[_0x1afee6(0xfa)]?.[_0x1afee6(0xea)]||_0x19a143[_0x1afee6(0xb8)]?.[_0x1afee6(0xe3)]?.[_0x1afee6(0xea)]||null,'body':_0x19a143[_0x1afee6(0xb8)]?.[_0x1afee6(0xd4)]||_0x19a143[_0x1afee6(0xb8)]?.['extendedTextMessage']?.[_0x1afee6(0x113)]||_0x19a143[_0x1afee6(0xb8)]?.[_0x1afee6(0xe3)]?.['caption']||_0x19a143['message']?.[_0x1afee6(0xfa)]?.[_0x1afee6(0x6e)]||''};}['buildConversationPrompt'](_0x367984){const _0x463a63=_0x4f1a2f;let _0x4e2439=BOT_PROMPT+'\x0a\x0aسياق\x20المحادثة\x20السابقة:\x0a';const _0xd53f6d=_0x367984[_0x463a63(0xd1)](-0xa);return _0xd53f6d[_0x463a63(0xe7)]((_0x5f3aed,_0x509986)=>{const _0x4686f0=_0x463a63,_0x16575f=_0x5f3aed[_0x4686f0(0xf5)]===_0x4686f0(0xc5)?'المستخدم':'المساعد';let _0x5f161f='';switch(_0x5f3aed[_0x4686f0(0x92)]){case _0x4686f0(0x113):_0x5f161f=_0x5f3aed[_0x4686f0(0xa4)];_0x5f3aed['contextInfo']?.[_0x4686f0(0xf9)]&&(_0x5f161f+=_0x4686f0(0x81)+_0x5f3aed[_0x4686f0(0xee)][_0x4686f0(0xf9)]+')');break;case _0x4686f0(0xa8):_0x5f161f=_0x4686f0(0xfe)+(_0x5f3aed[_0x4686f0(0xa4)]?_0x4686f0(0x90)+_0x5f3aed[_0x4686f0(0xa4)]:'');break;case _0x4686f0(0xb0):_0x5f161f='[ملف:\x20'+_0x5f3aed[_0x4686f0(0xef)]+']'+(_0x5f3aed['caption']?_0x4686f0(0x90)+_0x5f3aed['caption']:'')+_0x4686f0(0xd7)+_0x5f3aed[_0x4686f0(0xa4)];break;}_0x4e2439+='\x0a'+_0x16575f+'\x20('+new Date(_0x5f3aed[_0x4686f0(0xab)])[_0x4686f0(0x85)]('ar-SA')+'):\x20'+_0x5f161f;}),_0x4e2439+=_0x463a63(0x109),_0x4e2439;}async['getUserName'](_0x9208ca){const _0x41fdf3=_0x4f1a2f;try{const _0x1671c5=await this[_0x41fdf3(0xc0)][_0x41fdf3(0x9b)](_0x9208ca),_0x33079f=_0x1671c5?.[_0x41fdf3(0x84)]||_0x9208ca[_0x41fdf3(0xff)]('@')[0x0];return this[_0x41fdf3(0xbe)](_0x33079f);}catch{return this[_0x41fdf3(0xbe)](_0x9208ca[_0x41fdf3(0xff)]('@')[0x0]);}}async[_0x4f1a2f(0xad)](_0x2b7f2d){const _0xf8589c=_0x4f1a2f;try{const _0xc8486d=await fs[_0xf8589c(0x108)](_0x2b7f2d,_0xf8589c(0x91)),_0x9e121d=JSON[_0xf8589c(0xd0)](_0xc8486d);return Array[_0xf8589c(0xe2)](_0x9e121d)?_0x9e121d:[];}catch(_0x407ad3){if(_0x407ad3[_0xf8589c(0x8f)]===_0xf8589c(0xd3))return[];return console[_0xf8589c(0x94)](_0xf8589c(0xe0),_0x407ad3),[];}}async['saveUserHistory'](_0x218ebc,_0xa26b1){const _0x70cc06=_0x4f1a2f;try{await fs[_0x70cc06(0xa9)](_0x218ebc,JSON[_0x70cc06(0xeb)](_0xa26b1,null,0x2));}catch(_0x3d6564){console['error'](_0x70cc06(0x8e),_0x3d6564);}}['splitMessage'](_0x1ed982){const _0x180ff0=_0x4f1a2f,_0x225728=0x3e8;if(_0x1ed982[_0x180ff0(0x82)]<=_0x225728)return[_0x1ed982];const _0x478bb7=[];for(let _0x6a08d1=0x0;_0x6a08d1<_0x1ed982[_0x180ff0(0x82)];_0x6a08d1+=_0x225728){_0x478bb7[_0x180ff0(0xd6)](_0x1ed982[_0x180ff0(0x8b)](_0x6a08d1,_0x6a08d1+_0x225728));}return _0x478bb7;}[_0x4f1a2f(0xbe)](_0x528acf){const _0xfb14b3=_0x4f1a2f;return _0x528acf[_0xfb14b3(0x98)](/[^a-zA-Z0-9_-]/g,'_');}[_0x4f1a2f(0x6d)](_0x54e84d){const _0x5310f8=_0x4f1a2f;if(_0x54e84d[_0x5310f8(0xb8)]?.[_0x5310f8(0xd4)])return _0x54e84d['message'][_0x5310f8(0xd4)];else return _0x54e84d[_0x5310f8(0xb8)]?.[_0x5310f8(0xa2)]?.[_0x5310f8(0x113)]?_0x54e84d[_0x5310f8(0xb8)][_0x5310f8(0xa2)]['text']:'';}async[_0x4f1a2f(0x9a)](_0x4773a8,_0x3919ae){const _0x5b1724=_0x4f1a2f;try{await this[_0x5b1724(0xc0)][_0x5b1724(0x9a)](_0x4773a8,_0x3919ae);}catch(_0x23503d){console[_0x5b1724(0x94)](_0x5b1724(0xfd),_0x23503d);}}async[_0x4f1a2f(0xfb)](_0x3fa12c,_0x1f8628){const _0x3dcd81=_0x4f1a2f;try{await this[_0x3dcd81(0xc0)][_0x3dcd81(0x95)]([_0x1f8628[_0x3dcd81(0xcd)]]);}catch(_0x2a3439){console[_0x3dcd81(0x94)](_0x3dcd81(0xdb),_0x2a3439);}}}((async()=>{const _0x2b3cfb=_0x4f1a2f,_0x3b3890=new WhatsAppBot();await _0x3b3890[_0x2b3cfb(0x83)]();})());
